<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Details</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Hotel Details</h1>
    <div id="hotel-details">
        <p>Loading hotel details...</p>
    </div>
    <div id="booking-section">
        <form id="hotelBookingForm">
            <input type="date" name="check_in_date" id="check_in_date" placeholder="Check-In Date" required>
            <input type="date" name="check_out_date" id="check_out_date" placeholder="Check-Out Date" required>
            <button type="button" id="book-hotel-btn">Book Hotel</button>
        </form>
        <button id="cancel-booking-btn" style="display: none;">Cancel Booking</button>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const hotelId = urlParams.get('id');

        function fetchHotelDetails() {
            axios.get(`http://localhost/testing/routes/hotels/read_one.php?hotel_id=${hotelId}`)
                .then(response => {
                    if (response.data && response.data.data) {
                        const hotel = response.data.data;
                        const hotelDetails = document.getElementById('hotel-details');
                        hotelDetails.innerHTML = `
                            <p>Hotel Name: ${hotel.name || 'No Hotel Name'}</p>
                            <p>City: ${hotel.city || 'No City'}</p>
                            <p>Address: ${hotel.address || 'No Address'}</p>
                            <p>Price per Night: ${hotel.price_per_night || 'No Price'}</p>
                            <p>Available Rooms: ${hotel.available_rooms || 'No Rooms Available'}</p>
                        `;
                        checkBookingStatus();
                    } else {
                        console.error('No hotel found in response', response.data);
                    }
                })
                .catch(error => {
                    console.error('There was an error retrieving the hotel!', error);
                });
        }

        function checkBookingStatus() {
            // Adjust this function as needed to check booking status based on the specific user logic
            // For demonstration purposes, you can temporarily keep it simple or adjust it later
            document.getElementById('book-hotel-btn').style.display = 'block';
        }

function bookHotel() {
    const checkInDateInput = document.getElementById('check_in_date');
    const checkOutDateInput = document.getElementById('check_out_date');

    const checkInDate = checkInDateInput.value;
    const checkOutDate = checkOutDateInput.value;

    // Frontend Validation: Check if check-in date is before current date
    const currentDate = new Date();
    const selectedCheckInDate = new Date(checkInDate);

    if (selectedCheckInDate < currentDate) {
        alert("Check-in date cannot be before the current date.");
        checkInDateInput.focus();
        return;
    }

    // Further validation: Check if check-out date is before check-in date
    if (selectedCheckInDate >= new Date(checkOutDate)) {
        alert("Check-out date must be later than check-in date.");
        checkOutDateInput.focus();
        return;
    }

    const formData = new FormData();
    formData.append('user_id', 1); // Hardcoded user ID for demonstration
    formData.append('hotel_id', hotelId);
    formData.append('check_in_date', checkInDate);
    formData.append('check_out_date', checkOutDate);

    axios.post('http://localhost/testing/routes/hotel_bookings/create.php', formData)
        .then(response => {
            if (response.data && response.data.status === 'success') {
                alert('Hotel booked successfully!');
                window.location.reload();
            } else {
                alert('Failed to book hotel. ' + response.data.error);
            }
        })
        .catch(error => {
            console.error('There was an error booking the hotel!', error);
            alert('Failed to book hotel. Please try again later.');
        });
}



        function cancelBooking() {
            // Implement cancellation logic as per your requirements
            alert('Cancellation feature not implemented yet.');
        }

        document.getElementById('book-hotel-btn').addEventListener('click', bookHotel);
        document.getElementById('cancel-booking-btn').addEventListener('click', cancelBooking);

        fetchHotelDetails();
    </script>
</body>
</html>
